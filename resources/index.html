<html>
<head>
<meta charset="UTF-8">
<!--Import materialize.css-->
 <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
  <!--Let browser know website is optimized for mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

<title>Be happy</title>
</head>
<body>
	<nav>
    	<div class="nav-wrapper">
    		<a href="#" class="brand-logo">&nbsp;&nbsp;&nbsp;&nbsp;Free music</a>
    		<ul id="nav-mobile" class="right hide-on-med-and-down">
      			<li><a id='suggest' href="#">提点意见</a></li>
    		</ul>
    	</div>
  	</nav>

	<div class="row" style="text-align: center;max-width: 1000px">
        <div class="input-field col s12">
          <input id="url" type="text" class="validate">
          <label id="urllabel" for="url">歌曲名(例:梦一场)、歌手名</label>
        </div>
		<div>
		 	<a id="getSong" class="btn-floating btn-large waves-effect waves-light blue">
 				<i class="mdi-action-search"></i>
 			</a>
 		</div>

    <div id='progress' class="progress" style='display:none;'><div class="indeterminate"></div></div>
 		<div id="result" class="collection" style='border-width: 0px;'>
        
    </div>

  </div>

  <div id='suggestDiv' class="grey lighten-3 z-depth-4" style='display:none;width:400px; position: fixed; top: 35%; left: 50%; margin-left:-200px;'>
    <div class="row">
      <form class="col s12">
        <div class="row">
          <div class="input-field col s10">
            <i class="mdi-editor-mode-edit prefix"></i>
            <textarea id="suggestInfo" class="materialize-textarea"></textarea>
            <label for="suggestInfo">写下你的建议</label>
          </div>
        </div>
      </form>
    </div>
    <div style='margin-left: 130px;margin-bottom: 20px'>
      <button id='submitBtn' class="btn waves-effect waves-light" type="submit" name="action">提交
        <i class="mdi-content-send right"></i>
      </button>
    </div>
  </div>

<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
    	$("#getSong").click(function(){
    		var url = $("#url").val();
    		if("" == url){
    			$("#urllabel").html("<font color='red'>下载链接不能为空</font>");
    			return;
    		}
        $("#result").html("");
        $("#progress").show();
    		$.get("/xmusic?song_url="+url,function(result){
          $("#progress").hide();
          $("#result").html("<div><audio id='audio' src='' controls='controls'></audio></div>");
          if(!result){
            $("#result").html("<h3>找不到该歌曲</h3>");
            return;
          }
    			for(var i=0;i<result.length;i++){
    				data = result[i]
    				title = data['title']
    				pic = data['pic']
    				html = '<div style="padding:30px;float:left;"><div>'+title+'</div><img src="'+pic+'"/><div style="margin-top:5px;"><a style="margin-right:10px;" class="tryListen" href="#">试听</a><a href="'+data['location']+'">下载</a></div></div>';
    				$("#result").append(html);
    			}
          $('.tryListen').on('click', function(e){
              var elem = e.target;
              var location = $(elem).next().attr('href');
              $('#audio').attr('src',location);
              $('#audio')[0].play();
          });

    		},"json");
    	});

      $("#suggest").click(function(){
          $("#suggestDiv").show();
      });

      $("#submitBtn").click(function(){
          suggestInfo = $("#suggestInfo").val();
          if("" == suggestInfo){
            $("#suggestDiv").hide();
            return;
          }
          $.post("/suggest",{'info':suggestInfo},function(){
            $("#suggestDiv").hide();
          });
      });

      $("#url").keyup(function(event){
          if(event.keyCode == "13"){
            $("#getSong").click();
          }
      });

    });
</script>
</body>
</html>